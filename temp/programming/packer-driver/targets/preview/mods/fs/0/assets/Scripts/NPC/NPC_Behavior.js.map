{"version":3,"sources":["file:///D:/CongViec_HocTap/CongTy/Amobear/SupermarketTycoon3D/assets/Scripts/NPC/NPC_Behavior.ts"],"names":["_decorator","Component","easing","log","Node","SkeletalAnimation","tween","GameInfo","ccclass","property","NPC_Behavior","start","currentNPC_ID","Number","node","name","split","nextStand","updateStandForNPC","currentItems","currentSuccessClick","isDonePayment","setRotationFromEuler","getComponent","play","to","position","NPC_DoorStand","smooth","call","active","NPC_StandPoints","rotate","isNPCDoneMove","isCanTouch","update","dt","isPaid","tien","scheduleOnce","NPCpaidTimes","isWaitingToGetChange"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,G,OAAAA,G;AAAKC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,iB,OAAAA,iB;AAAmBC,MAAAA,K,OAAAA,K;;AAC7DC,MAAAA,Q,iBAAAA,Q;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;;8BAIjBU,Y,WADZF,OAAO,CAAC,cAAD,C,UAGHC,QAAQ,CAACL,IAAD,C,oCAHb,MACaM,YADb,SACkCT,SADlC,CAC4C;AAAA;AAAA;;AAAA;;AAAA,iDAKhB,IALgB;;AAAA,0CAMtB,KANsB;;AAAA,wDAOR,KAPQ;AAAA;;AAU9BU,QAAAA,KAAK,GAAS;AACpB;AACA,eAAKC,aAAL,GAAqBC,MAAM,CAAC,KAAKC,IAAL,CAAUC,IAAV,CAAeC,KAAf,CAAqB,GAArB,EAA0B,CAA1B,CAAD,CAA3B;AACA,eAAKC,SAAL,CAAe,KAAf;AACH;;AAGMC,QAAAA,iBAAiB,GAAS;AAC7B;AACA;AAAA;AAAA,oCAASC,YAAT,GAAwB;AAAA;AAAA,oCAASC,mBAAjC;AACA,cAAIC,aAAsB,GAAG,KAA7B;AACA,cAAI,KAAKT,aAAL,GAAqB;AAAA;AAAA,oCAASQ,mBAAlC,EAAuDC,aAAa,GAAG,IAAhB;AACvD,eAAKJ,SAAL,CAAeI,aAAf;AACH;;AAGMJ,QAAAA,SAAS,CAACI,aAAD,EAA+B;AAE3C;AAEA;AAEA,eAAKP,IAAL,CAAUQ,oBAAV,CAA+B,CAA/B,EAAkC,CAAC,EAAnC,EAAuC,CAAvC;AAEA,eAAKR,IAAL,CAAUS,YAAV,CAAuBlB,iBAAvB,EAA0CmB,IAA1C,CAA+C,SAA/C;;AAEA,cAAIH,aAAJ,EAAmB;AACff,YAAAA,KAAK,CAAC,KAAKQ,IAAN,CAAL,CACKW,EADL,CACQ,CADR,EACW;AAAEC,cAAAA,QAAQ,EAAE;AAAA;AAAA,wCAASC;AAArB,aADX,EACiD;AAAEzB,cAAAA,MAAM,EAAEA,MAAM,CAAC0B;AAAjB,aADjD,EAEKC,IAFL,CAEU,MAAM,KAAKf,IAAL,CAAUgB,MAAV,GAAmB,KAFnC,EAGKnB,KAHL;AAIH,WALD,MAMK;AACDR,YAAAA,GAAG,CAAC,WAAD,EAAc,KAAKS,aAAnB,CAAH;AAEAN,YAAAA,KAAK,CAAC,KAAKQ,IAAN,CAAL,CACKW,EADL,CACQ,CADR,EACW;AAAEC,cAAAA,QAAQ,EAAE;AAAA;AAAA,wCAASK,eAAT,CAAyB,KAAKnB,aAAL,GAAqB;AAAA;AAAA,wCAASQ,mBAAvD,EAA4EM;AAAxF,aADX,EAC+G;AAAExB,cAAAA,MAAM,EAAEA,MAAM,CAAC0B;AAAjB,aAD/G,EAEKC,IAFL,CAEU,MAAM;AAER,mBAAKf,IAAL,CAAUQ,oBAAV,CAA+B,CAA/B,EAAkC;AAAA;AAAA,wCAASS,eAAT,CAAyB,KAAKnB,aAAL,GAAqB;AAAA;AAAA,wCAASQ,mBAAvD,EAA4EY,MAA9G,EAAsH,CAAtH;AAEA;AAAA;AAAA,wCAASC,aAAT,GAAyB,IAAzB;AAEA;AAAA;AAAA,wCAASC,UAAT,GAAsB,IAAtB;AAEA,mBAAKpB,IAAL,CAAUS,YAAV,CAAuBlB,iBAAvB,EAA0CmB,IAA1C,CAA+C,MAA/C;AACH,aAXL,EAYKb,KAZL;AAaH;AACJ;;AAGSwB,QAAAA,MAAM,CAACC,EAAD,EAAmB;AAC/B;AACA,cAAI,KAAKxB,aAAL,KAAuB;AAAA;AAAA,oCAASQ,mBAAhC,IAAuD;AAAA;AAAA,oCAASD,YAAT,KAA0B,CAAjF,IAAsF,CAAC,KAAKkB,MAAhG,EAAwG;AACpG,iBAAKA,MAAL,GAAc,IAAd;AACA,iBAAKC,IAAL,CAAUR,MAAV,GAAmB,IAAnB;AACA,iBAAKhB,IAAL,CAAUS,YAAV,CAAuBlB,iBAAvB,EAA0CmB,IAA1C,CAA+C,mBAA/C;AACA,iBAAKe,YAAL,CAAkB,MAAM,KAAKzB,IAAL,CAAUS,YAAV,CAAuBlB,iBAAvB,EAA0CmB,IAA1C,CAA+C,kBAA/C,CAAxB,EAA4F,GAA5F;AACH,WAP8B,CAS/B;;;AACA,cAAI,KAAKa,MAAL,IAAe,KAAKzB,aAAL,KAAuB;AAAA;AAAA,oCAAS4B,YAA/C,IAA+D,CAAC,KAAKC,oBAAzE,EAA+F;AAC3F,iBAAKA,oBAAL,GAA4B,IAA5B;AACA,iBAAKH,IAAL,CAAUR,MAAV,GAAmB,KAAnB;AACA,iBAAKhB,IAAL,CAAUS,YAAV,CAAuBlB,iBAAvB,EAA0CmB,IAA1C,CAA+C,MAA/C;AACH;AACJ;;AA7EuC,O;;;;;iBAG3B,I","sourcesContent":["import { _decorator, Component, easing, log, Node, SkeletalAnimation, tween } from 'cc';\nimport { GameInfo } from '../Const/GameInfo';\nconst { ccclass, property } = _decorator;\n\n\n@ccclass('NPC_Behavior')\nexport class NPC_Behavior extends Component {\n\n    @property(Node)\n    tien: Node = null;\n\n    currentNPC_ID: number = null;\n    isPaid: boolean = false;\n    isWaitingToGetChange: boolean = false;\n\n\n    protected start(): void {\n        // setup NPC id\n        this.currentNPC_ID = Number(this.node.name.split(\"_\")[1]);\n        this.nextStand(false);\n    }\n\n\n    public updateStandForNPC(): void {\n        // this.currentNPC_ID -= 1;\n        GameInfo.currentItems = GameInfo.currentSuccessClick;\n        let isDonePayment: boolean = false;\n        if (this.currentNPC_ID < GameInfo.currentSuccessClick) isDonePayment = true;\n        this.nextStand(isDonePayment);\n    }\n\n\n    public nextStand(isDonePayment: boolean): void {\n\n        // GameInfo.isNPCDoneMove = false;\n\n        // GameInfo.isCanTouch = false;\n\n        this.node.setRotationFromEuler(0, -90, 0);\n\n        this.node.getComponent(SkeletalAnimation).play(\"walking\");\n\n        if (isDonePayment) {\n            tween(this.node)\n                .to(1, { position: GameInfo.NPC_DoorStand }, { easing: easing.smooth })\n                .call(() => this.node.active = false)\n                .start();\n        }\n        else {\n            log(\"updateId:\", this.currentNPC_ID);\n\n            tween(this.node)\n                .to(1, { position: GameInfo.NPC_StandPoints[this.currentNPC_ID - GameInfo.currentSuccessClick].position }, { easing: easing.smooth })\n                .call(() => {\n\n                    this.node.setRotationFromEuler(0, GameInfo.NPC_StandPoints[this.currentNPC_ID - GameInfo.currentSuccessClick].rotate, 0);\n\n                    GameInfo.isNPCDoneMove = true;\n\n                    GameInfo.isCanTouch = true;\n\n                    this.node.getComponent(SkeletalAnimation).play(\"idle\");\n                })\n                .start();\n        }\n    }\n\n\n    protected update(dt: number): void {\n        // pay money\n        if (this.currentNPC_ID === GameInfo.currentSuccessClick && GameInfo.currentItems === 0 && !this.isPaid) {\n            this.isPaid = true;\n            this.tien.active = true;\n            this.node.getComponent(SkeletalAnimation).play(\"Payment_CardStart\");\n            this.scheduleOnce(() => this.node.getComponent(SkeletalAnimation).play(\"Payment_CardIdle\"), 0.2);\n        }\n\n        // waiting to get change\n        if (this.isPaid && this.currentNPC_ID === GameInfo.NPCpaidTimes && !this.isWaitingToGetChange) {\n            this.isWaitingToGetChange = true;\n            this.tien.active = false;\n            this.node.getComponent(SkeletalAnimation).play(\"idle\");\n        }\n    }\n}\n\n"]}